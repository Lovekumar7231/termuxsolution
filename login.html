<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Login</title>
    <link rel="stylesheet" href="auth-style.css"> 
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       (function(){ emailjs.init("ijs5TFBMM18XzlFac"); })();
    </script>
</head>
<body>

<div class="auth-box">
    <h2 class="glitch" id="loginTitle">SYSTEM LOGIN</h2>

    <div id="login-form">
        <div class="input-group">
            <label>CODENAME</label>
            <input type="text" id="loginUser" placeholder="Enter Codename">
        </div>

        <div class="input-group">
            <label>PASSWORD</label>
            <input type="password" id="loginPass" placeholder="Enter Password">
        </div>

        <div style="border:1px dashed #00ff41; padding:10px; margin-bottom: 20px;">
            <label style="color:gold; font-size: 12px; font-weight: bold;">SECURITY CHECK</label>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                <span id="captcha-question" style="color:#ffd700; font-size:18px; font-weight:bold;"></span>
                <input type="number" id="captcha-input" placeholder="?" style="width:60px; text-align:center; height: 35px;">
            </div>
        </div>

        <button id="loginBtn" onclick="handleLogin()">EXECUTE LOGIN</button>
        
        <div class="link-container" style="margin-top:20px; text-align:center; display:flex; flex-direction:column; gap:10px;">
            <a href="signup.html" style="color:#00ff41; text-decoration:none; font-size:13px;">Create New Account</a>
            <a href="forgot_password.html" style="color:#ff512f; text-decoration:none; font-size:13px; font-weight:bold;">Forgot Password?</a>
        </div>
    </div>

    <div id="otp-form" style="display:none;">
        <p style="color:red; font-weight:bold; text-align:center;">⚠️ ADMIN DETECTED</p>
        <div class="input-group">
            <label>ENTER OTP CODE</label>
            <input type="number" id="adminOtp" placeholder="XXXX">
        </div>
        <button onclick="verifyAdminOtp()">UNLOCK SYSTEM</button>
    </div>
</div>

<script>
    // Captcha Logic
    let n1 = Math.floor(Math.random() * 10);
    let n2 = Math.floor(Math.random() * 10);
    document.getElementById('captcha-question').innerText = `${n1} + ${n2} = ?`;

    let generatedOtp = 0;

    function handleLogin() {
        const user = document.getElementById('loginUser').value.trim();
        const pass = document.getElementById('loginPass').value.trim();
        const captcha = document.getElementById('captcha-input').value;

        if(parseInt(captcha) !== (n1 + n2)) {
            alert("❌ Captcha Wrong!");
            return;
        }

        // Admin Special Check
        if (user === "Admin" && pass === "Love@728296#$") {
            sendAdminOTP();
            return;
        }

        // Normal Login Simulation
        if(user && pass) {
            localStorage.setItem("agentName", user);
            alert("✅ Welcome Agent " + user);
            window.location.href = "index.html";
        } else {
            alert("⚠️ Please fill all fields!");
        }
    }

    function sendAdminOTP() {
        generatedOtp = Math.floor(1000 + Math.random() * 9000);
        const params = {
            to_email: "termuxhacking72@gmail.com",
            otp_code: generatedOtp
        };

        emailjs.send("service_idclxul", "template_6sk2up1", params)
            .then(() => {
                alert("✅ Admin OTP Sent!");
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('otp-form').style.display = 'block';
            });
    }

    function verifyAdminOtp() {
        if(document.getElementById('adminOtp').value == generatedOtp) {
            window.location.href = "index.html";
        } else {
            alert("❌ Denied!");
        }
    }
</script>

</body>
</html>
