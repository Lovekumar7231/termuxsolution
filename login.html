<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Login</title>
    <link rel="stylesheet" href="auth-style.css"> 
    
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    <script type="text/javascript">
       // अपना EmailJS Public Key यहाँ डालें
       (function(){ emailjs.init("ijs5TFBMM18XzlFac"); })();
    </script>
</head>
<body>

<div class="auth-box">
    <h2 class="glitch" id="loginTitle">SYSTEM LOGIN</h2>

    <div id="login-form">
        <div class="input-group">
            <label>CODENAME</label>
            <input type="text" id="loginUser" placeholder="Enter Codename">
        </div>

        <div class="input-group">
            <label>PASSWORD</label>
            <input type="password" id="loginPass" placeholder="Enter Password">
        </div>

        <div class="input-group" style="border:1px dashed #00ff41; padding:10px;">
            <label style="color:gold;">SECURITY CHECK</label>
            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:5px;">
                <span id="captcha-question" style="color:white; font-size:18px; font-weight:bold;"></span>
                <input type="number" id="captcha-input" placeholder="?" style="width:60px; text-align:center;">
            </div>
        </div>

        <button id="loginBtn" onclick="handleLogin()">EXECUTE LOGIN</button>
        
        <div style="margin-top:15px; font-size:12px;">
            <a href="signup.html" style="color:#00ff41;">Create New Account</a>
        </div>
    </div>

    <div id="otp-form" style="display:none;">
        <p style="color:red; font-weight:bold; animation: blink 1s infinite;">⚠️ ADMIN DETECTED</p>
        <p style="font-size:12px; color:#ccc; margin-bottom:10px;">Verification Code sent to Email.</p>
        
        <div class="input-group">
            <label>ENTER OTP CODE</label>
            <input type="number" id="adminOtp" placeholder="XXXX">
        </div>
        <button onclick="verifyAdminOtp()">UNLOCK SYSTEM</button>
    </div>
</div>

<script>
    // --- CAPTCHA SETUP ---
    let n1 = Math.floor(Math.random() * 10);
    let n2 = Math.floor(Math.random() * 10);
    document.getElementById('captcha-question').innerText = `${n1} + ${n2} = ?`;

    let generatedOtp = 0;

    function handleLogin() {
        const user = document.getElementById('loginUser').value.trim();
        const pass = document.getElementById('loginPass').value.trim();
        const captcha = document.getElementById('captcha-input').value;

        // 1. Captcha Check
        if(parseInt(captcha) !== (n1 + n2)) {
            alert("❌ Captcha Wrong!");
            return;
        }

        // 2. ADMIN CHECK (Specific Logic)
        // यहाँ अपना पासवर्ड चेक करो
        if (user === "Admin" && pass === "Love@728296#$") {
            sendAdminOTP(); // OTP भेजो
            return;
        }

        // 3. NORMAL USER LOGIN
        // (अगर Database Login है तो उसे यहाँ add कर सकते हो, अभी direct access दे रहा हूँ)
        if(user && user !== "Admin") {
            localStorage.setItem("agentName", user);
            localStorage.setItem("isAdmin", "false");
            alert("✅ Welcome Agent " + user);
            window.location.href = "index.html";
        } else {
            alert("⚠️ Invalid Username or Password!");
        }
    }

    function sendAdminOTP() {
        const btn = document.getElementById('loginBtn');
        btn.innerText = "SENDING OTP...";
        btn.disabled = true;

        generatedOtp = Math.floor(1000 + Math.random() * 9000);

        // EmailJS Parameters
        const params = {
            to_email: "termuxhacking72@gmail.com", // जिस ईमेल पर OTP चाहिए
            name: "Admin Commander",
            otp_code: generatedOtp
        };

        // Service ID और Template ID वही है जो तुमने दी थी
        emailjs.send("service_idclxul", "template_6sk2up1", params)
            .then(function() {
                alert("✅ OTP Sent to Admin Email!");
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('otp-form').style.display = 'block';
            }, function(error) {
                alert("❌ Email Error: " + JSON.stringify(error));
                btn.innerText = "EXECUTE LOGIN";
                btn.disabled = false;
            });
    }

    function verifyAdminOtp() {
        const entered = document.getElementById('adminOtp').value;
        if(entered == generatedOtp) {
            localStorage.setItem("agentName", "Admin");
            localStorage.setItem("isAdmin", "true"); // यह बहुत ज़रूरी है
            window.location.href = "index.html";
        } else {
            alert("❌ WRONG OTP! Access Denied.");
        }
    }
</script>

<style>
@keyframes blink { 50% { opacity: 0; } }
</style>

</body>
</html>

