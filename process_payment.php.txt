<?php
session_start();
include 'db_connect.php';

if (!isset($_SESSION['user_id'])) {
    die("Please Login First");
}

if ($_SERVER["REQUEST_METHOD"] == "POST") {
    
    $user_id = $_SESSION['user_id'];
    $product_name = $_POST['product_name'];
    $amount = $_POST['amount'];
    $txn_id = $_POST['transaction_id'];

    // 1. Order ko database mein save karein
    // Note: Asli product_id logic complex hota hai, abhi hum direct naam save kar rahe hain simple rakhne ke liye
    
    // (Aapko database.sql mein 'orders' table update karna pad sakta hai agar product_id foreign key hai. 
    // Simplify karne ke liye hum direct insert kar rahe hain 'products' table ko bypass karke testing ke liye)
    
    // Is example ke liye hum maan lete hain payment successful hai
    
    // Query: Check karein ki user ne pehle khareeda hai ya nahi (Optional)
    
    // Insert Logic (Humein 'orders' table thoda modify karna padega ya direct use karein)
    // Filhal testing ke liye hum bas Success dikhayenge
    
    ?>
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <title>Processing...</title>
        <style>
            body { background: black; color: #00ff00; font-family: monospace; text-align: center; padding-top: 100px; }
            .loader { border: 4px solid #333; border-top: 4px solid #00ff00; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto 20px;}
            @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        </style>
    </head>
    <body>
        <div class="loader"></div>
        <h2>Verifying Transaction ID: <?php echo $txn_id; ?>...</h2>
        <p>Please wait while we connect to the server.</p>

        <script>
            setTimeout(function() {
                alert("Payment Successful! Content Unlocked.");
                window.location.href = "index.php?payment=success";
            }, 3000); // 3 second baad redirect
        </script>
    </body>
    </html>
    <?php
}
?>
